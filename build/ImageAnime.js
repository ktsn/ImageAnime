// Generated by CoffeeScript 1.7.1
var ImageAnime, ImageAnimeState;

ImageAnimeState = {
  stopped: 0,
  pausing: 1,
  loadingAndPausing: 2,
  playing: 3
};

ImageAnime = (function() {
  ImageAnime.prototype.index = 0;

  ImageAnime.prototype.frames = null;

  ImageAnime.prototype.times = null;

  ImageAnime.prototype.term_index = -1;

  ImageAnime.prototype.state = ImageAnimeState.stopped;

  ImageAnime.prototype.timer = null;

  function ImageAnime(frames, times) {
    this.frames = frames;
    this.times = times;
    this.term_index = this.frames.length - 1;
  }

  ImageAnime.prototype.play = function() {
    this.state = ImageAnimeState.playing;
    this.setTransigionTimer(this.index + 1);
    return this.onStartAnime();
  };

  ImageAnime.prototype.pause = function() {
    if (this.timer !== null) {
      clearTimeout(this.timer);
    }
    return this.state = ImageAnimeState.pausing;
  };

  ImageAnime.prototype.stop = function() {
    if (this.timer !== null) {
      clearTimeout(this.timer);
    }
    this.state = ImageAnimeState.stopped;
    this.jumpFrame(0);
    return this.onStopAnime();
  };

  ImageAnime.prototype.jumpFrame = function(index) {
    this.index = index;
    this.onChangeFrame(this.frames[index]);
    if (this.state >= ImageAnimeState.loadingAndPausing) {
      return this.setTransigionTimer(index + 1);
    }
  };

  ImageAnime.prototype.setTransigionTimer = function(next_index) {
    if (this.timer !== null) {
      clearTimeout(this.timer);
    }
    if (next_index > this.term_index) {
      this.stop();
      return;
    }
    return this.timer = setTimeout((function(_this) {
      return function() {
        return _this.jumpFrame(next_index);
      };
    })(this), this.times[next_index] - this.times[next_index - 1]);
  };


  /*
   Notification function of ImageAnime
  =============================================
   */

  ImageAnime.prototype.onStartAnime = function() {};

  ImageAnime.prototype.onChangeFrame = function(frame) {};

  ImageAnime.prototype.onStopAnime = function() {};

  return ImageAnime;

})();
